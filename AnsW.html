<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anscript Hub v0.6 | Auto-Intelligence</title>
    <style>
        :root {
            --p: #bdacff; --g: #00ffcc; --r: #ff4d4d; --bg: #050505;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #111122 0%, #050505 100%);
        }

        /* Giao di·ªán K√≠nh m·ªù */
        .glass { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid rgba(189, 172, 255, 0.2); border-radius: 15px; }

        /* M√†n h√¨nh ƒêƒÉng nh·∫≠p & Qu√©t Online */
        #login-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 1000; background: var(--bg); }
        .login-box { padding: 40px; text-align: center; width: 380px; transition: 0.5s; }
        
        .user-card {
            padding: 15px; margin: 12px 0; cursor: pointer; transition: 0.3s;
            border-left: 4px solid var(--p); background: rgba(255,255,255,0.05); text-align: left;
            position: relative; overflow: hidden;
        }
        .user-card:hover { background: var(--p); color: black; transform: translateX(10px); }
        .user-card.reconnecting { border-left-color: var(--g); animation: pulse 1.5s infinite; }

        /* Dashboard */
        #main-ui { display: none; height: 100vh; grid-template-columns: 260px 1fr; }
        .sidebar { padding: 25px; border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 10px; }
        .nav-item { padding: 14px; cursor: pointer; border-radius: 10px; transition: 0.3s; color: #aaa; font-weight: 500; }
        .nav-item.active { background: linear-gradient(90deg, var(--p), #7a5cf5); color: white; box-shadow: 0 4px 15px rgba(122, 92, 245, 0.4); }

        .content { padding: 40px; overflow-y: auto; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-item { padding: 20px; background: rgba(0,0,0,0.4); border-bottom: 3px solid var(--p); }
        .stat-item span { display: block; font-size: 11px; opacity: 0.5; text-transform: uppercase; }
        .stat-item b { font-size: 20px; color: var(--p); }

        .script-btn {
            width: 100%; padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.05); 
            border: 1px solid #333; color: white; cursor: pointer; border-radius: 8px; text-align: left; transition: 0.2s;
        }
        .script-btn:hover { background: var(--p); color: black; transform: translateY(-2px); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="glass login-box">
            <h1 style="color:var(--p); letter-spacing: 3px;">ANSRIPT HUB</h1>
            <p id="scan-status" style="font-size: 13px; opacity: 0.7; margin-bottom: 20px;">ƒêang t√¨m thi·∫øt b·ªã online...</p>
            <div id="user-list"></div>
            <p style="margin-top: 30px; font-size: 10px; opacity: 0.4;">V0.6 - AUTO RECONNECT SYSTEM</p>
        </div>
    </div>

    <div id="main-ui">
        <div class="sidebar glass">
            <div style="margin-bottom: 30px; padding: 10px;">
                <b style="color:var(--p); font-size: 20px;">ANSRIPT VN</b>
            </div>
            <div class="nav-item active" onclick="switchTab('home', this)">üìä DASHBOARD</div>
            <div class="nav-item" onclick="switchTab('scripts', this)">üìú SCRIPT HUB</div>
            <div class="nav-item" onclick="switchTab('settings', this)">‚öôÔ∏è SETTINGS</div>
            <button onclick="logout()" style="margin-top: auto; padding: 12px; border: 1px solid var(--r); background: none; color: var(--r); cursor: pointer; border-radius: 8px; font-weight: bold;">ƒêƒÇNG XU·∫§T</button>
        </div>

        <div class="content">
            <div id="tab-home" class="tab-content">
                <h2 style="color: var(--p);">TH√îNG S·ªê NH√ÇN V·∫¨T</h2>
                <div class="stat-grid">
                    <div class="stat-item glass"><span>PLAYER</span><b id="st-name">N/A</b></div>
                    <div class="stat-item glass"><span>HEALTH</span><b id="st-hp">0</b></div>
                    <div class="stat-item glass"><span>SPEED</span><b id="st-ws">16</b></div>
                    <div class="stat-item glass"><span>FPS</span><b id="st-fps">60</b></div>
                </div>
                <div class="stat-item glass" style="width: 100%; border-bottom-color: var(--g);">
                    <span>GAME HI·ªÜN T·∫†I</span><b id="st-game" style="color:var(--g)">ƒêang t·∫£i...</b>
                </div>
            </div>

            <div id="tab-scripts" class="tab-content" style="display:none">
                <h2 style="color: var(--p);">KHO SCRIPT T·ªîNG H·ª¢P</h2>
                <div class="script-grid">
                    <button class="script-btn" onclick="exec('Infinite Yield', 'https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source')">üöÄ Infinite Yield (Admin)</button>
                    <button class="script-btn" onclick="exec('Ans Console', 'https://raw.githubusercontent.com/hothiptv/Anscript/refs/heads/Script/Ans_console')">üìü Ans Console (Dev)</button>
                    <button class="script-btn" onclick="exec('Redz Hub', 'https://raw.githubusercontent.com/redz-hub/redz-V5-remake/main/main.luau')">üî¥ Redz Hub V5 (Blox Fruit)</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ws;
        let isConnected = false;
        const lastUser = localStorage.getItem('ans_last_user');

        function initWS() {
            ws = new WebSocket("wss://anshub-production.up.railway.app/");

            ws.onopen = () => {
                console.log("H·ªá th·ªëng ƒë√£ s·∫µn s√†ng.");
                // N·∫øu tr∆∞·ªõc ƒë√≥ ƒë√£ k·∫øt n·ªëi, b√°o cho server bi·∫øt ƒë·ªÉ l·∫•y l·∫°i danh s√°ch
                ws.send(JSON.stringify({ type: "get_online_list" }));
            };

            ws.onmessage = (e) => {
                const d = JSON.parse(e.data);

                // 1. X·ª¨ L√ù DANH S√ÅCH ONLINE & T·ª∞ ƒê·ªòNG K·∫æT N·ªêI
                if (d.type === "online_list") {
                    const listDiv = document.getElementById('user-list');
                    listDiv.innerHTML = "";
                    
                    if (d.list.length === 0) {
                        document.getElementById('scan-status').innerText = "Ch∆∞a t√¨m th·∫•y ng∆∞·ªùi ch∆°i n√†o online...";
                    } else {
                        document.getElementById('scan-status').innerText = "Ch·ªçn nh√¢n v·∫≠t ƒë·ªÉ ƒëi·ªÅu khi·ªÉn:";
                        d.list.forEach(name => {
                            const card = document.createElement('div');
                            const isMe = (name === lastUser);
                            card.className = "user-card glass" + (isMe ? " reconnecting" : "");
                            card.innerHTML = `<b>${name}</b><br><small>${isMe ? "ƒêang t·ª± ƒë·ªông k·∫øt n·ªëi l·∫°i..." : "Nh·∫•n ƒë·ªÉ k·∫øt n·ªëi"}</small>`;
                            
                            card.onclick = () => {
                                ws.send(JSON.stringify({ type: "web_connect", playerName: name }));
                                card.innerHTML = `<b>${name}</b><br><small style='color:var(--g)'>H√ÉY B·∫§M CH·∫§P NH·∫¨N TRONG ROBLOX!</small>`;
                            };
                            listDiv.appendChild(card);

                            // T·ª∞ ƒê·ªòNG G·ª¨I L·ªÜNH K·∫æT N·ªêI N·∫æU TR√ôNG T√äN C≈®
                            if (isMe && !isConnected) {
                                ws.send(JSON.stringify({ type: "web_connect", playerName: name }));
                            }
                        });
                    }
                }

                // 2. K·∫æT N·ªêI TH√ÄNH C√îNG
                if (d.type === "connect_success") {
                    isConnected = true;
                    localStorage.setItem('ans_last_user', d.data.name);
                    document.getElementById('login-screen').style.display = "none";
                    document.getElementById('main-ui').style.display = "grid";
                    updateUI(d.data);
                }

                // 3. C·∫¨P NH·∫¨T TH√îNG S·ªê
                if (d.type === "ui_update") {
                    updateUI(d.data);
                }

                // 4. L·ªñI
                if (d.type === "error") {
                    alert(d.msg);
                    if(d.msg.includes("kh√¥ng online")) logout();
                }
            };

            ws.onclose = () => {
                isConnected = false;
                setTimeout(initWS, 2000); // T·ª± ƒë·ªông k·∫øt n·ªëi l·∫°i socket n·∫øu server Railway b·ªã restart
            };
        }

        function updateUI(data) {
            document.getElementById('st-name').innerText = data.name;
            document.getElementById('st-hp').innerText = Math.floor(data.hp) + "/100";
            document.getElementById('st-ws').innerText = data.ws;
            document.getElementById('st-game').innerText = data.game;
        }

        function switchTab(tab, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = "none");
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('tab-' + tab).style.display = "block";
            el.classList.add('active');
        }

        function exec(name, url) {
            ws.send(JSON.stringify({ type: "execute", code: `loadstring(game:HttpGet('${url}'))()` }));
            alert("ƒê√£ g·ª≠i l·ªánh th·ª±c thi: " + name);
        }

        function logout() {
            localStorage.removeItem('ans_last_user');
            location.reload();
        }

        initWS();
    </script>
</body>
</html>
