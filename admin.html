<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel Premium - Anscript Hub</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 300px; background: #0a0a0a; border-right: 1px solid #222; padding: 20px; overflow-y: auto; }
        .tab-block { margin-bottom: 20px; border-bottom: 1px solid #1a1a1a; padding-bottom: 10px; }
        .tab-header { display: flex; align-items: center; justify-content: space-between; color: #00ff96; font-weight: bold; margin-bottom: 8px; }
        .tab-actions button { background: none; border: none; cursor: pointer; font-size: 14px; padding: 2px 5px; }
        
        /* File list */
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 12px; cursor: pointer; color: #ccc; border-radius: 4px; }
        .file-item:hover { background: #1a1a1a; color: #fff; }
        .file-item .del-file { color: #ff4d4d; opacity: 0; transition: 0.2s; }
        .file-item:hover .del-file { opacity: 1; }

        /* Main Editor */
        .main { flex: 1; padding: 30px; background: #111; display: none; overflow-y: auto; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 6px; outline: none; }
        input:focus, textarea:focus { border-color: #00ff96; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-save { background: #00ff96; color: #000; flex: 2; }
        .btn-tl { background: #333; color: #fff; flex: 1; border: 1px solid #444; }
        .btn-ls { background: #0084ff; color: #fff; margin-top: 15px; width: 100%; }
        .btn-add { background: #222; color: #00ff96; width: 100%; border: 1px dashed #00ff96; margin-bottom: 20px; }
        
        .auth { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>
    <div id="auth" class="auth">
        <div style="text-align:center">
            <h2 style="color:#00ff96">ADMIN ACCESS</h2>
            <input type="password" id="pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." style="width:250px; text-align:center">
            <br><button onclick="login()" style="width:250px; background:#00ff96; color:000">UNLOCK</button>
        </div>
    </div>

    <div class="sidebar">
        <h3 style="color:#00ff96; border-left: 4px solid #00ff96; padding-left: 10px;">AN HUB EXPLORER</h3>
        <button class="btn-add" onclick="addT()">+ TH√äM CHUY√äN M·ª§C M·ªöI</button>
        <div id="sList"></div>
    </div>

    <div class="main" id="main">
        <h2 id="eName" style="color:#00ff96; margin-top:0">EDITOR</h2>
        <label>T√™n Script:</label>
        <input type="text" id="name" placeholder="V√≠ d·ª•: Auto Farm Blox Fruit">
        
        <label>·∫¢nh b√¨a (T·ªâ l·ªá ƒë√£ ch·ªçn):</label>
        <div style="display:flex; gap:10px">
            <input type="text" id="img" placeholder="D√°n link ·∫£nh v√†o ƒë√¢y..." oninput="checkTL()">
            <button id="tlBtn" class="btn-tl" onclick="setRatio()">T·ªà L·ªÜ</button>
        </div>
        
        <label>M√£ Script (Loadstring ho·∫∑c Source):</label>
        <textarea id="script" rows="12" placeholder="D√°n m√£ code t·∫°i ƒë√¢y..."></textarea>
        
        <label>M√¥ t·∫£ & Th√¥ng tin:</label>
        <textarea id="desc" rows="3" placeholder="V√≠ d·ª•: Creator: An | Version: 1.0..."></textarea>
        
        <div class="btn-group">
            <button class="btn-save" id="saveB" onclick="save()">L∆ØU THAY ƒê·ªîI</button>
        </div>
        <button class="btn-ls" onclick="getLS()">COPY LOADSTRING ƒê·ªÇ D√ôNG TRONG GAME</button>
    </div>

    <script>
        const API = window.location.origin;
        const DEF = "https://media.discordapp.net/attachments/1472992341156434219/1472992415303340276/Picsart_26-02-16_14-27-25-185.jpg";
        let db = { tabs: [], scripts: [] }, curI = null;

        function login() { if(document.getElementById('pass').value === "0904") { document.getElementById('auth').style.display='none'; load(); } else alert("M·∫≠t kh·∫©u sai b√©t!"); }
        
        async function load() {
            try {
                const r = await fetch(`${API}/get-hub`);
                db = await r.json();
                render();
            } catch(e) { alert("L·ªói k·∫øt n·ªëi server!"); }
        }

        function render() {
            const l = document.getElementById('sList'); l.innerHTML = "";
            db.tabs.forEach((t, ti) => {
                let tabHtml = `
                <div class="tab-block">
                    <div class="tab-header">
                        <span>üìÅ ${t.Name}</span>
                        <div class="tab-actions">
                            <button onclick="editT(${ti})" title="S·ª≠a t√™n">‚úèÔ∏è</button>
                            <button onclick="delT(${ti})" title="X√≥a tab" style="color:red">üóëÔ∏è</button>
                            <button onclick="addS('${t.Name}')" title="Th√™m script" style="color:#fff">‚ûï</button>
                        </div>
                    </div>`;
                
                db.scripts.forEach((s, si) => {
                    if(s.tab === t.Name) {
                        tabHtml += `
                        <div class="file-item" onclick="openE(${si})">
                            <span>üìÑ ${s.name}</span>
                            <span class="del-file" onclick="event.stopPropagation(); delS(${si})">‚úï</span>
                        </div>`;
                    }
                });
                tabHtml += `</div>`;
                l.innerHTML += tabHtml;
            });
        }

        // --- H√ÄM X·ª¨ L√ù TAB ---
        function addT() { 
            let n = prompt("Nh·∫≠p t√™n Chuy√™n m·ª•c m·ªõi:"); 
            if(n) { db.tabs.push({Name: n}); render(); } 
        }
        function editT(i) {
            let n = prompt("ƒê·ªïi t√™n chuy√™n m·ª•c th√†nh:", db.tabs[i].Name);
            if(n) {
                let oldName = db.tabs[i].Name;
                db.tabs[i].Name = n;
                // C·∫≠p nh·∫≠t l·∫°i c√°c script thu·ªôc tab n√†y
                db.scripts.forEach(s => { if(s.tab === oldName) s.tab = n; });
                render();
            }
        }
        function delT(i) {
            if(confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a Tab [${db.tabs[i].Name}] v√† T·∫§T C·∫¢ script b√™n trong kh√¥ng?`)) {
                let name = db.tabs[i].Name;
                db.tabs = db.tabs.filter((_, idx) => idx !== i);
                db.scripts = db.scripts.filter(s => s.tab !== name);
                document.getElementById('main').style.display = 'none';
                render();
            }
        }

        // --- H√ÄM X·ª¨ L√ù SCRIPT ---
        function addS(t) { 
            let n = prompt(`T√™n Script cho m·ª•c [${t}]:`); 
            if(n) { 
                db.scripts.push({name: n, tab: t, img: DEF, script: "", describe: "", ratio: "ratio-1-1"}); 
                render(); 
                openE(db.scripts.length - 1);
            } 
        }
        function delS(i) {
            if(confirm(`X√≥a script [${db.scripts[i].name}]?`)) {
                db.scripts.splice(i, 1);
                document.getElementById('main').style.display = 'none';
                render();
            }
        }

        function openE(i) {
            curI = i; const s = db.scripts[i];
            document.getElementById('main').style.display = 'block';
            document.getElementById('name').value = s.name;
            document.getElementById('img').value = (s.img && s.img !== DEF) ? s.img : ""; 
            document.getElementById('script').value = s.script || "";
            document.getElementById('desc').value = s.describe || "";
            checkTL();
        }

        function checkTL() { document.getElementById('tlBtn').disabled = false; }

        function setRatio() {
            let r = prompt("Ch·ªçn t·ªâ l·ªá card:\n1. Vu√¥ng (1:1)\n2. Ngang (16:9)\n3. D·ªçc (9:16)", "1");
            db.scripts[curI].ratio = r=="2"?"ratio-16-9":(r=="3"?"ratio-9-16":"ratio-1-1");
            alert("ƒê√£ ƒë·ªïi t·ªâ l·ªá sang: " + db.scripts[curI].ratio);
        }

        async function save() {
            if(curI !== null) {
                db.scripts[curI].name = document.getElementById('name').value;
                let iv = document.getElementById('img').value.trim();
                db.scripts[curI].img = iv === "" ? DEF : iv;
                db.scripts[curI].script = document.getElementById('script').value;
                db.scripts[curI].describe = document.getElementById('desc').value;
            }
            document.getElementById('saveB').innerText = "ƒêANG L∆ØU...";
            try {
                const res = await fetch(`${API}/save-hub`, { 
                    method: 'POST', 
                    headers: {'Content-Type':'application/json'}, 
                    body: JSON.stringify({newData: db}) 
                });
                if(res.ok) alert("‚úÖ ƒê√£ l∆∞u l√™n GitHub th√†nh c√¥ng!");
                else alert("‚ùå L·ªói l∆∞u file!");
            } catch(e) { alert("L·ªói k·∫øt n·ªëi server!"); }
            document.getElementById('saveB').innerText = "L∆ØU THAY ƒê·ªîI";
            render();
        }

        function getLS() {
            const ls = `loadstring(game:HttpGet("${API}/get-hub"))()`;
            navigator.clipboard.writeText(ls);
            alert("ƒê√£ copy Loadstring chu·∫©n!");
        }
    </script>
</body>
</html>
